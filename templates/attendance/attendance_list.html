{% extends 'base.html' %}
{% load ias_filter %}

{% block content %}
<div class="container">
     <h1>Attendance List</h1>
    <table class="table">
        <thead>
            <tr>
                <th>Week</th>
                <th>Article</th>
                <th>Due Date</th>
                {% for user in users %}
                <th>{{ user }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
        {% if page_obj %}
            {% for attendance in page_obj %}
            <tr>
                <td>{{ attendance.0 }}</td>
                <td><a href="{% url 'ias:ai_detail' attendance.0 %}">{{ attendance.1 }}</a></td>
                <td>{{ attendance.2|add_days:7 }}</td>
                {% for hit in attendance.4 %}
                <td>
                    {% if hit == 0 or hit is None %}
                        <t>X</t>
                    {% else %}
                        {{ hit }}%
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="4">There's no Attendance.</td>
            </tr>
        {% endif %}

        </tbody>
    </table>

    <!-- Pagination links -->
     <div class="pagination justify-content-center">
         <span class="step-links">
             {% if page_obj.has_previous %}
                 <a href="?page=1">&laquo; first</a>
                 <a href="?page={{ page_obj.previous_page_number }}">previous</a>
             {% endif %}

             <span class="current">
                 Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
             </span>

             {% if page_obj.has_next %}
                 <a href="?page={{ page_obj.next_page_number }}">next</a>
                 <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
             {% endif %}
         </span>
     </div>
 </div>

</div>


{% endblock %}

{% block script %}
<script type='text/javascript'>
const page_elements = document.getElementsByClassName("page-link");
Array.from(page_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        document.getElementById('page').value = this.dataset.page;
        document.getElementById('searchForm').submit();
    });
});
const btn_search = document.getElementById("btn_search");
btn_search.addEventListener('click', function() {
    document.getElementById('kw').value = document.getElementById('search_kw').value;
    document.getElementById('page').value = 1;  // Start from page 1 when searching
    document.getElementById('searchForm').submit();
});
</script>
{% endblock %}
